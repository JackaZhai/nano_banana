<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>控制台 | a.zhai's ToolBox</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <!-- Favicon -->
    <link rel="icon" href="{{ url_for('static', filename='favicon.svg') }}" type="image/svg+xml">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.svg') }}" type="image/svg+xml">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/font-awesome.min.css') }}">
    <style>
        /* Fallback for Font Awesome icons */
        .fas, .fa, .nav-icon, .stat-icon, .activity-icon, .conversation-avatar, .message-avatar, .status-icon {
            font-family: 'Font Awesome 6 Free', 'Font Awesome 6 Brands', Arial, sans-serif;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- 侧边栏 -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="#" class="sidebar-brand">
                    <div class="brand-logo">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div class="brand-text">
                        <div class="brand-title">a.zhai's ToolBox</div>
                        <div class="brand-subtitle">ToolBox</div>
                    </div>
                </a>
            </div>

            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-page="dashboard">
                    <i class="fas fa-home nav-icon"></i>
                    <span class="nav-label">仪表盘</span>
                </a>
                <a href="#" class="nav-item" data-page="image-generation">
                    <i class="fas fa-palette nav-icon"></i>
                    <span class="nav-label">图像生成</span>
                </a>
                <a href="#" class="nav-item" data-page="chat">
                    <i class="fas fa-comments nav-icon"></i>
                    <span class="nav-label">智能对话</span>
                </a>
                <a href="#" class="nav-item" data-page="api-keys">
                    <i class="fas fa-key nav-icon"></i>
                    <span class="nav-label">API 密钥</span>
                </a>
                <a href="#" class="nav-item" data-page="settings">
                    <i class="fas fa-cog nav-icon"></i>
                    <span class="nav-label">设置</span>
                </a>
                <a href="https://github.com/JackaZhai/nano_banana/issues" class="nav-item" target="_blank">
                    <i class="fas fa-bug nav-icon"></i>
                    <span class="nav-label">Bug 反馈</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <div class="user-menu">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-info">
                        <div class="user-name">管理员</div>
                        <div class="user-email">admin@nanobanana.ai</div>
                    </div>
                    <div class="user-status">在线</div>
                </div>
            </div>
        </aside>

        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 顶部栏 -->
            <header class="topbar">
                <div class="topbar-left">
                    <div class="page-title">
                        <h1 id="pageTitle">仪表盘</h1>
                        <p class="page-subtitle" id="pageSubtitle">欢迎使用 a.zhai's ToolBox 服务平台</p>
                    </div>
                </div>

                <div class="topbar-right">
                    <div class="topbar-actions">
                        <button class="action-button" id="themeToggle" title="切换主题">
                            <i class="fas fa-moon"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- 页面内容 -->
            <div class="page-content">
                <!-- 仪表盘页面 -->
                <div class="page-section active" id="page-dashboard">
                    <div class="dashboard">
                        <div class="content-card-header">
                            <h2 class="content-card-title">概览</h2>
                        </div>

                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-coins"></i>
                                </div>
                                <div class="stat-value" id="creditsBalance">--</div>
                                <div class="stat-label">账户余额</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-key"></i>
                                </div>
                                <div class="stat-value" id="apiKeyStatus">检查中...</div>
                                <div class="stat-label">API Key</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-server"></i>
                                </div>
                                <div class="stat-value" id="apiHostDisplay">--</div>
                                <div class="stat-label">API 节点</div>
                            </div>
                        </div>

                        <div class="content-card">
                            <div class="content-card-header">
                                <h3 class="content-card-title">模型状态</h3>
                                <button class="btn btn-ghost btn-sm" id="refreshModelStatus">
                                    <i class="fas fa-sync-alt"></i>
                                    刷新
                                </button>
                            </div>
                            <div class="content-card-body">
                                <div class="model-status-list" id="modelStatusList"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="page-section" id="page-image-generation">
                    <div class="image-generation">
                        <div class="content-card-header">
                            <h2 class="content-card-title">AI 图像生成</h2>
                        </div>

                        <div class="generation-layout">
                            <!-- 参数面板 -->
                            <div class="parameters-panel">
                                <div class="parameter-group">
                                    <label class="parameter-label">
                                        <span>提示词</span>
                                        <span class="required">*</span>
                                    </label>
                                    <textarea id="promptInput" class="form-textarea"
                                              placeholder="描述您想要生成的图像，例如：一只科幻机械猫站在霓虹城市中央，蓝紫色光影，超写实"
                                              rows="4"></textarea>
                                    <div class="parameter-hint">尽可能详细地描述您想要的图像</div>
                                </div>

                                <div class="parameter-group">
                                    <label class="parameter-label">模型选择</label>
                                    <select id="modelSelect" class="form-select">
                                        <option value="nano-banana-fast">nano-banana-fast (极速)</option>
                                        <option value="nano-banana">nano-banana (标准)</option>
                                        <option value="nano-banana-pro">nano-banana-pro (高质量)</option>
                                    </select>
                                </div>

                                <div class="parameter-group">
                                    <label class="parameter-label">画面比例</label>
                                    <select id="aspectRatioSelect" class="form-select">
                                        <option value="auto">自动</option>
                                        <option value="1:1">1:1 (正方形)</option>
                                        <option value="16:9">16:9 (宽屏)</option>
                                        <option value="9:16">9:16 (竖屏)</option>
                                    </select>
                                </div>

                                <div class="parameter-group">
                                    <label class="parameter-label">分辨率</label>
                                    <select id="resolutionSelect" class="form-select">
                                        <option value="1K">1K (1024×1024)</option>
                                        <option value="2K">2K (2048×2048)</option>
                                        <option value="4K">4K (4096×4096)</option>
                                    </select>
                                </div>

                                <div class="parameter-group">
                                    <label class="parameter-label">参考图</label>
                                    <input type="file" id="referenceImagesInput" class="form-input" accept="image/*" multiple>
                                    <div class="parameter-hint">最多 3 张，每张不超过 5MB。</div>
                                    <div class="reference-list" id="referenceImagesList"></div>
                                </div>

                                <div class="form-actions">
                                    <button class="btn btn-primary btn-lg" id="generateBtn">
                                        <i class="fas fa-magic"></i>
                                        生成图像
                                    </button>
                                    <button class="btn btn-outline" id="resetFormBtn">
                                        <i class="fas fa-redo"></i>
                                        重置
                                    </button>
                                </div>
                            </div>

                            <!-- 预览面板 -->
                            <div class="preview-panel">
                                <div class="preview-container">
                                    <div class="preview-placeholder">
                                        <div class="preview-placeholder-icon">
                                            <i class="fas fa-image"></i>
                                        </div>
                                        <p>生成的图像将显示在这里</p>
                                        <p class="text-sm text-tertiary">填写提示词并点击"生成图像"开始</p>
                                    </div>
                                </div>

                                <div class="generation-controls">
                                    <div class="control-group">
                                        <div class="progress">
                                            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                                        </div>
                                        <span class="progress-text" id="progressText">0%</span>
                                    </div>
                                    <div class="control-group">
                                        <button class="btn btn-outline btn-sm" id="downloadBtn" disabled>
                                            <i class="fas fa-download"></i>
                                            下载
                                        </button>
                                        <button class="btn btn-outline btn-sm" id="clearBtn">
                                            <i class="fas fa-trash"></i>
                                            清空
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 智能对话页面 -->
                <div class="page-section" id="page-chat">
                    <div class="content-card-header">
                        <h2 class="content-card-title">智能对话</h2>
                        <p class="content-card-subtitle">功能正在开发中</p>
                    </div>
                    <div class="content-card">
                        <div class="empty-state">
                            <div class="empty-icon">
                                <i class="fas fa-tools"></i>
                            </div>
                            <h3 class="empty-title">正在开发中</h3>
                            <p class="text-tertiary">该模块正在完善，敬请期待。</p>
                        </div>
                    </div>
                </div>

                <!-- API密钥页面 -->
                <div class="page-section" id="page-api-keys">
                    <div class="api-keys">
                        <div class="content-card-header">
                            <h2 class="content-card-title">API 密钥管理</h2>
                        </div>

                        <div class="keys-status">
                            <div class="status-item">
                                <div class="status-icon success">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div>
                                    <div class="status-label">加密存储</div>
                                    <div class="status-value">已启用</div>
                                </div>
                            </div>
                            <div class="status-item">
                                <div class="status-icon warning">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div>
                                    <div class="status-label">当前密钥</div>
                                    <div class="status-value" id="currentKeyStatus">未设置</div>
                                </div>
                            </div>
                            <div class="status-item">
                                <div class="status-icon info">
                                    <i class="fas fa-history"></i>
                                </div>
                                <div>
                                    <div class="status-label">最后使用</div>
                                    <div class="status-value" id="lastUsedTime">从未使用</div>
                                </div>
                            </div>
                        </div>

                        <div class="add-key-form">
                            <h3>添加新密钥</h3>
                            <div class="form-group">
                                <label class="form-label">API 密钥</label>
                                <input type="text" id="newApiKey" class="form-input"
                                       placeholder="输入以 sk- 开头的 API 密钥">
                                <div class="form-hint">密钥将加密存储，确保安全</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">密钥名称（可选）</label>
                                <input type="text" id="keyName" class="form-input"
                                       placeholder="例如：生产环境密钥">
                            </div>
                            <div class="form-actions">
                                <button class="btn btn-primary" id="addKeyBtn">
                                    <i class="fas fa-save"></i>
                                    添加并设为当前
                                </button>
                                <button class="btn btn-outline" id="testKeyBtn">
                                    <i class="fas fa-vial"></i>
                                    测试密钥
                                </button>
                            </div>
                        </div>

                        <div class="keys-list">
                            <div class="content-card-header">
                                <h3 class="content-card-title">密钥列表</h3>
                                <button class="btn btn-ghost btn-sm" id="refreshKeysBtn">
                                    <i class="fas fa-sync-alt"></i>
                                    刷新
                                </button>
                            </div>
                            <table class="keys-table">
                                <thead>
                                    <tr>
                                        <th>名称</th>
                                        <th>密钥掩码</th>
                                        <th>来源</th>
                                        <th>状态</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="keysTableBody">
                                    <tr class="keys-empty">
                                        <td colspan="5" class="text-center py-8">
                                            <i class="fas fa-key text-3xl text-tertiary mb-2"></i>
                                            <p class="text-tertiary">暂无 API 密钥</p>
                                            <p class="text-sm text-muted">添加您的第一个 API 密钥以开始使用</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 设置页面 -->
                <div class="page-section" id="page-settings">
                    <div class="settings">
                        <div class="content-card-header">
                            <h2 class="content-card-title">系统设置</h2>
                            <p class="content-card-subtitle"></p>
                        </div>

                        <div class="settings-group">
                            <h3 class="settings-group-title">常规设置</h3>
                            <div class="settings-item">
                                <div class="settings-label">
                                    <div class="settings-name">界面语言</div>
                                    <div class="settings-description">选择应用程序显示语言</div>
                                </div>
                                <select class="form-select" style="width: 12rem;">
                                    <option value="zh-CN" selected>简体中文</option>
                                    <option value="en-US">English</option>
                                </select>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">
                                    <div class="settings-name">主题模式</div>
                                    <div class="settings-description">选择应用程序颜色主题</div>
                                </div>
                                <div class="theme-selector">
                                    <button class="btn btn-outline btn-sm" data-theme="dark">
                                        <i class="fas fa-moon"></i>
                                        深色
                                    </button>
                                    <button class="btn btn-outline btn-sm" data-theme="light">
                                        <i class="fas fa-sun"></i>
                                        浅色
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="settings-group">
                            <h3 class="settings-group-title">API 设置</h3>
                            <div class="settings-item">
                                <div class="settings-label">
                                    <div class="settings-name">API 主机</div>
                                    <div class="settings-description">选择 API 服务器地址</div>
                                </div>
                                <select class="form-select" id="apiHostSelect" style="width: 20rem;">
                                    <option value="https://api.grsai.com">海外节点</option>
                                    <option value="https://grsai.dakka.com.cn">国内直连</option>
                                </select>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">
                                    <div class="settings-name">图像生成模型</div>
                                    <div class="settings-description">默认使用的图像生成模型</div>
                                </div>
                                <select class="form-select" id="imageModelSelect" style="width: 15rem;">
                                    <option value="nano-banana-fast">Nano Banana Fast</option>
                                    <option value="nano-banana" selected>Nano Banana</option>
                                    <option value="nano-banana-pro">Nano Banana Pro</option>
                                    <option value="nano-banana-pro-vt">Nano Banana Pro VT</option>
                                </select>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">
                                    <div class="settings-name">聊天模型</div>
                                    <div class="settings-description">默认使用的聊天模型</div>
                                </div>
                                <select class="form-select" id="chatModelSelect" style="width: 15rem;">
                                    <option value="nano-banana-pro" selected>Nano Banana Pro</option>
                                    <option value="nano-banana-pro-vt">Nano Banana Pro VT</option>
                                    <option value="nano-banana-fast">Nano Banana Fast</option>
                                    <option value="nano-banana">Nano Banana</option>
                                    <option value="gemini-3-pro">Gemini 3 Pro</option>
                                    <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                                    <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                                    <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash Lite</option>
                                </select>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">
                                    <div class="settings-name">流式响应</div>
                                    <div class="settings-description">启用聊天时的流式响应</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="streamToggle" checked>
                                    <span class="switch-slider"></span>
                                </label>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">
                                    <div class="settings-name">请求超时</div>
                                    <div class="settings-description">API 请求超时时间</div>
                                </div>
                                <select class="form-select" id="timeoutSelect" style="width: 8rem;">
                                    <option value="30">30 秒</option>
                                    <option value="60" selected>60 秒</option>
                                    <option value="120">120 秒</option>
                                </select>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">
                                    <div class="settings-name">重试次数</div>
                                    <div class="settings-description">API 请求失败时的重试次数</div>
                                </div>
                                <select class="form-select" id="retrySelect" style="width: 8rem;">
                                    <option value="0">0 次</option>
                                    <option value="1" selected>1 次</option>
                                    <option value="2">2 次</option>
                                    <option value="3">3 次</option>
                                </select>
                            </div>
                        </div>

                        <div class="settings-group">
                            <h3 class="settings-group-title">关于</h3>
                            <div class="about-content">
                                <div class="app-info">
                                    <div class="brand-logo">
                                        <i class="fas fa-brain"></i>
                                    </div>
                                    <div>
                                        <h4>a.zhai's ToolBox</h4>
                                        <p class="text-tertiary">版本 1.1.2</p>
                                    </div>
                                </div>
                                <div class="about-links">
                                    <a href="/manual" class="btn btn-ghost btn-sm" target="_blank" rel="noopener">
                                        <i class="fas fa-book"></i>
                                        用户手册
                                    </a>
                                    <a href="#" class="btn btn-ghost btn-sm">
                                        <i class="fas fa-code"></i>
                                        API 文档
                                    </a>
                                    <a href="#" class="btn btn-ghost btn-sm">
                                        <i class="fas fa-bug"></i>
                                        报告问题
                                    </a>
                                </div>
                                <div class="about-footer">
                                    <p class="text-sm text-tertiary">© 2025 a.zhai's ToolBox. 保留所有权利。</p>
                                    <p class="text-xs text-muted">Based on Flask and modern web technologies</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 全局脚本 -->
    <script>
        // 全局配置
        window.AppConfig = {
            apiHost: "{{ api_host }}",
            hasApiKey: {{ 'true' if has_api_key else 'false' }},
            endpoints: {
                draw: "{{ api_host }}/v1/draw/nano-banana",
                result: "{{ api_host }}/v1/draw/result",
                chat: "{{ api_host }}/v1/chat/completions"
            }
        };
    </script>

    <script src="{{ url_for('static', filename='js/api-service.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
